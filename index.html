<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>REFLECTIONS - Precision Laser Defense</title>
    <!-- Modern techie fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/game.css?v=10">
</head>
<body>
    <h1><span class="neon-text">REFLECTIONS</span></h1>
    
    <div id="instructions">
        <div class="instruction-header">‚ö° MISSION BRIEFING ‚ö°</div>
        <div class="instruction-content">
            <div class="instruction-item">üéØ <strong>OBJECTIVE:</strong> Protect the core from laser breach</div>
            <div class="instruction-item">üîß <strong>CONTROLS:</strong> Drag mirrors to redirect laser paths</div>
            <div class="instruction-item">‚öôÔ∏è <strong>PRECISION:</strong> Mirrors snap to grid for perfect alignment</div>
            <div class="instruction-item">üöÄ <strong>EXECUTION:</strong> Launch sequence when ready</div>
            <div class="instruction-item">üì± <strong>MOBILE:</strong> Rotate device for optimal experience</div>
        </div>
    </div>
    
    <div id="timer-display" class="timer-display">
        <div class="timer-label">LASER DURATION</div>
        <div id="timer-value" class="timer-value">00:00.000</div>
    </div>
    
    <div id="ui">
        <div id="status" class="status-modern">Position your mirrors to protect the core!</div>
        <button id="launchBtn" class="btn-primary">üöÄ LAUNCH SEQUENCE</button>
        <button id="resetBtn" class="btn-secondary">üîÑ RESET GRID</button>
        <button id="clearCacheBtn" class="btn-debug">üóëÔ∏è CLEAR CACHE</button>
    </div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="game-over-modal hidden">
        <div class="game-over-content">
            <div class="game-over-animation">
                <div class="explosion-effect"></div>
                <div class="glitch-text">CORE BREACH</div>
            </div>
            <div class="game-over-stats">
                <div class="stat-item">
                    <div class="stat-label">LASER DURATION</div>
                    <div id="finalTime" class="stat-value">00:00.000</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">REFLECTIONS</div>
                    <div id="finalReflections" class="stat-value">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">PRECISION SCORE</div>
                    <div id="finalScore" class="stat-value neon-text">0</div>
                </div>
            </div>
            <button id="retryBtn" class="btn-primary retry-btn">üîÑ RETRY MISSION</button>
        </div>
    </div>

    <!-- Mobile info bubble -->
    <div id="infoBubble" class="info-bubble">
        <button id="infoButton" class="info-button">i</button>
        <div id="infoPopup" class="info-popup hidden">
            <div class="info-content">
                <button id="closeInfo" class="close-button">√ó</button>
                <strong>How to Play:</strong><br>
                1. Drag mirrors to position them on the grid<br>
                2. Mirrors snap to grid lines when released<br>
                3. Redirect lasers AWAY from the center target<br>
                4. Tap "Launch Lasers" to start<br>
                5. Protect the center - if any laser hits it, you lose!
            </div>
        </div>
    </div>

    <!-- Game Configuration -->
    <script src="js/config/GameConfig.js"></script>
    
    <!-- Game Classes -->
    <script src="js/classes/SATCollision.js?v=8"></script>
    <script src="js/classes/Mirror.js?v=8"></script>
    <script src="js/classes/Laser.js?v=8"></script>
    <script src="js/classes/Spawner.js?v=8"></script>
    <script src="js/classes/Game.js?v=8"></script>
    
    <!-- Initialize Game -->
    <script src="js/main.js"></script>
    
    <!-- Simple cache clear test -->
    <script>
        console.log('Simple script test - this should show in console');
        
        // Try to add click handler directly in HTML
        setTimeout(() => {
            const btn = document.getElementById('clearCacheBtn');
            console.log('Direct script found button:', btn);
            
            if (btn) {
                btn.onclick = async function() {
                    console.log('Clearing all caches...');
                    
                    try {
                        // Clear service worker caches
                        if ('caches' in window) {
                            const cacheNames = await caches.keys();
                            console.log('Found caches:', cacheNames);
                            await Promise.all(
                                cacheNames.map(cacheName => {
                                    console.log('Deleting cache:', cacheName);
                                    return caches.delete(cacheName);
                                })
                            );
                        }
                        
                        // Clear storage
                        localStorage.clear();
                        sessionStorage.clear();
                        
                        // Clear IndexedDB
                        if ('indexedDB' in window) {
                            // This is more complex, but we'll do a basic clear
                            try {
                                indexedDB.deleteDatabase('gameData');
                            } catch(e) {
                                console.log('IndexedDB clear skipped:', e);
                            }
                        }
                        
                        console.log('All caches cleared successfully');
                        alert('Cache cleared! Page will reload with fresh content...');
                        
                        // Add a unique timestamp to force cache bypass
                        const timestamp = Date.now();
                        const url = window.location.href.split('?')[0] + '?nocache=' + timestamp;
                        
                        // Reload with cache busting
                        window.location.replace(url);
                        
                    } catch (error) {
                        console.error('Cache clear error:', error);
                        alert('Cache clear completed (some errors). Reloading...');
                        window.location.reload(true);
                    }
                };
            }
        }, 1000);
    </script>
</body>
</html>