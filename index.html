<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Reflection Game - Ultra Precise Edition</title>
    <link rel="stylesheet" href="styles/game.css?v=8">
</head>
<body>
    <h1>Reflection Game - Ultra Precise Edition</h1>
    
    <div id="instructions">
        <strong>How to Play:</strong><br>
        1. Drag the mirrors to position them on the grid (touch and drag on mobile)<br>
        2. Mirrors snap perfectly to grid lines when released<br>
        3. Place mirrors to redirect lasers AWAY from the center target<br>
        4. Click "Launch Lasers" to start<br>
        5. Protect the center - if any laser hits it, you lose!<br>
        <em>Mobile users: Rotate to landscape for better experience</em>
    </div>
    
    <div id="ui">
        <div id="status">Position your mirrors to protect the center!</div>
        <button id="launchBtn">Launch Lasers</button>
        <button id="resetBtn">Reset Game</button>
        <button id="clearCacheBtn" style="background: #e74c3c;">Clear Cache</button>
    </div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>

    <!-- Mobile info bubble -->
    <div id="infoBubble" class="info-bubble">
        <button id="infoButton" class="info-button">i</button>
        <div id="infoPopup" class="info-popup hidden">
            <div class="info-content">
                <button id="closeInfo" class="close-button">Ã—</button>
                <strong>How to Play:</strong><br>
                1. Drag mirrors to position them on the grid<br>
                2. Mirrors snap to grid lines when released<br>
                3. Redirect lasers AWAY from the center target<br>
                4. Tap "Launch Lasers" to start<br>
                5. Protect the center - if any laser hits it, you lose!
            </div>
        </div>
    </div>

    <!-- Game Configuration -->
    <script src="js/config/GameConfig.js"></script>
    
    <!-- Game Classes -->
    <script src="js/classes/SATCollision.js?v=8"></script>
    <script src="js/classes/Mirror.js?v=8"></script>
    <script src="js/classes/Laser.js?v=8"></script>
    <script src="js/classes/Spawner.js?v=8"></script>
    <script src="js/classes/Game.js?v=8"></script>
    
    <!-- Initialize Game -->
    <script src="js/main.js"></script>
    
    <!-- Simple cache clear test -->
    <script>
        console.log('Simple script test - this should show in console');
        
        // Try to add click handler directly in HTML
        setTimeout(() => {
            const btn = document.getElementById('clearCacheBtn');
            console.log('Direct script found button:', btn);
            
            if (btn) {
                btn.onclick = async function() {
                    console.log('Clearing all caches...');
                    
                    try {
                        // Clear service worker caches
                        if ('caches' in window) {
                            const cacheNames = await caches.keys();
                            console.log('Found caches:', cacheNames);
                            await Promise.all(
                                cacheNames.map(cacheName => {
                                    console.log('Deleting cache:', cacheName);
                                    return caches.delete(cacheName);
                                })
                            );
                        }
                        
                        // Clear storage
                        localStorage.clear();
                        sessionStorage.clear();
                        
                        // Clear IndexedDB
                        if ('indexedDB' in window) {
                            // This is more complex, but we'll do a basic clear
                            try {
                                indexedDB.deleteDatabase('gameData');
                            } catch(e) {
                                console.log('IndexedDB clear skipped:', e);
                            }
                        }
                        
                        console.log('All caches cleared successfully');
                        alert('Cache cleared! Page will reload with fresh content...');
                        
                        // Add a unique timestamp to force cache bypass
                        const timestamp = Date.now();
                        const url = window.location.href.split('?')[0] + '?nocache=' + timestamp;
                        
                        // Reload with cache busting
                        window.location.replace(url);
                        
                    } catch (error) {
                        console.error('Cache clear error:', error);
                        alert('Cache clear completed (some errors). Reloading...');
                        window.location.reload(true);
                    }
                };
            }
        }, 1000);
    </script>
</body>
</html>